<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:syncfusion="clr-namespace:Syncfusion.Maui.Inputs;assembly=Syncfusion.Maui.Inputs"
             xmlns:syncfusionButtons="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
             xmlns:helpers="clr-namespace:EasyPedidos.Helpers"
             x:Class="EasyPedidos.Pages.PedidoPage"
             BackgroundColor="#FFFFFF">

    <ScrollView>
        <VerticalStackLayout Padding="20,35,20,25" Spacing="22">

            <!-- CABEÇALHO -->
            <VerticalStackLayout HorizontalOptions="Center" Spacing="10">
                <Image Source="logo.png" HeightRequest="48" WidthRequest="48" />
                <Label Text="Novo Pedido" FontSize="26" FontAttributes="Bold" TextColor="#FF6B35" HorizontalOptions="Center" />
            </VerticalStackLayout>

            <!-- 1. ITENS DO PEDIDO -->
            <Frame BackgroundColor="#FFFFFF" CornerRadius="18" Padding="18" BorderColor="#EEEEEE" HasShadow="False">
                <VerticalStackLayout Spacing="14">
                    <Label Text="1. Itens do Pedido" FontSize="17" FontAttributes="Bold" TextColor="#FF6B35" />

                    <!-- ADICIONAR ITEM -->
                    <Grid ColumnDefinitions="*,80" ColumnSpacing="10">
                        <!-- ITEM (SfComboBox FLUINDO) -->
                        <Frame Grid.Column="0" BackgroundColor="#F9F9F9" CornerRadius="14" Padding="0" BorderColor="#DDDDDD" HasShadow="False">
                            <syncfusion:SfComboBox
                                ItemsSource="{Binding Cardapio}"
                                SelectedItem="{Binding ItemSelecionado}"
                                DisplayMemberPath="Descricao"
                                Placeholder="Selecione..."
                                TextColor="#333333"
                                FontSize="15"
                                Background="#F9F9F9"
                                Margin="14,10"
                                VerticalOptions="Center" />
                        </Frame>

                        <!-- QUANTIDADE -->
                        <Frame Grid.Column="1" BackgroundColor="#F9F9F9" CornerRadius="14" Padding="0" BorderColor="#DDDDDD" HasShadow="False">
                            <Entry
                                Text="{Binding Quantidade}"
                                Placeholder="Qtd"
                                Keyboard="Numeric"
                                TextColor="#333333"
                                FontSize="15"
                                HorizontalTextAlignment="Center"
                                VerticalOptions="Center"
                                HeightRequest="48"
                                Margin="8,0" />
                        </Frame>
                    </Grid>

                    <!-- BOTÃO ADICIONAR -->
                    <syncfusionButtons:SfButton
                        Text="Adicionar"
                        Command="{Binding AdicionarItemCommand}"
                        Background="#FF6B35"
                        TextColor="White"
                        FontAttributes="Bold"
                        FontSize="15"
                        CornerRadius="14"
                        HeightRequest="48"
                        Padding="18,0"
                        ImageSource="plus_white.png"
                        HorizontalOptions="End" />

                    <!-- LISTA DE ITENS -->
                    <CollectionView
                        ItemsSource="{Binding Pedido.Itens}"
                        EmptyView="Nenhum item adicionado ainda."
                        HeightRequest="320">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#FFFFFF" CornerRadius="16" Padding="14" Margin="0,6" HasShadow="True">
                                    <Frame.Shadow>
                                        <Shadow Brush="#10000000" Offset="0,2" Radius="6" />
                                    </Frame.Shadow>
                                    <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">
                                        <!-- NOME, QTD, OBS -->
                                        <VerticalStackLayout Grid.Column="0" Spacing="5">
                                            <Label Text="{Binding Nome}" FontSize="15" FontAttributes="Bold" TextColor="#333" />
                                            <Label Text="{Binding Quantidade, StringFormat='{0}x • R$ {1:F2}'}" FontSize="13" TextColor="#777" />
                                            <Frame BackgroundColor="#FFF8F5" CornerRadius="10" Padding="0" BorderColor="#FFE0D6" HasShadow="False">
                                                <Entry
                                                    Text="{Binding Observacao}"
                                                    Placeholder="Obs..."
                                                    TextColor="#666"
                                                    FontSize="13"
                                                    Margin="10,8"
                                                    HeightRequest="45"
                                                    VerticalOptions="Center" />
                                            </Frame>
                                        </VerticalStackLayout>

                                        <!-- PREÇO -->
                                        <Label
                                            Grid.Column="1"
                                            Text="{Binding Subtotal, StringFormat='R$ {0:F2}'}"
                                            FontSize="15"
                                            FontAttributes="Bold"
                                            TextColor="#FF6B35"
                                            VerticalOptions="Center"
                                            HorizontalOptions="End" />

                                        <!-- BOTÃO X -->
                                        <syncfusionButtons:SfButton
                                            Grid.Column="2"
                                            Text="X"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.RemoverItemCommand}"
                                            CommandParameter="{Binding .}"
                                            Background="#FF4444"
                                            TextColor="White"
                                            FontSize="11"
                                            WidthRequest="32"
                                            HeightRequest="32"
                                            CornerRadius="16"
                                            VerticalOptions="Start" />
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- TOTAL -->
                    <BoxView HeightRequest="1" BackgroundColor="#EEEEEE" Margin="0,8" />
                    <Grid ColumnDefinitions="*,Auto">
                        <!-- COLUNA 0: TEXTO "Total:" -->
                        <Label
                                Grid.Column="0"
                                Text="Total:"
                                FontSize="19"
                                FontAttributes="Bold"
                                TextColor="#333"
                                VerticalOptions="Center"
                                Margin="0,0,10,0" />

                        <!-- COLUNA 1: VALOR TOTAL -->
                        <Label
                                Grid.Column="1"
                                Text="{Binding Pedido.Total, StringFormat='R$ {0:F2}'}"
                                FontSize="21"
                                FontAttributes="Bold"
                                TextColor="#FF6B35"
                                VerticalOptions="Center"
                                HorizontalOptions="End" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- 2. LOCAL DE CONSUMO -->
            <!-- 2. LOCAL DE CONSUMO -->
            <Frame BackgroundColor="#FFFFFF" CornerRadius="18" Padding="18" BorderColor="#EEEEEE" HasShadow="False">
                <VerticalStackLayout Spacing="12">
                    <Label Text="2. Onde vai consumir?" FontSize="17" FontAttributes="Bold" TextColor="#FF6B35" />

                    <!-- 3 OPÇÕES EM GRID (EXCLUSIVO VIA BINDING) -->
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                        <!-- NO LOCAL -->
                        <Frame
                Grid.Column="0"
                BackgroundColor="{Binding Pedido.LocalConsumo, Converter={StaticResource EnumToBoolDescConverter}, ConverterParameter=NoLocal|#FFF0E6|#F9F9F9}"
                CornerRadius="16"
                Padding="0"
                BorderColor="#DDDDDD"
                HasShadow="False"
                HorizontalOptions="Fill">
                            <syncfusionButtons:SfRadioButton
                    Text="No Local"
                    IsChecked="{Binding Pedido.LocalConsumo, Converter={StaticResource EnumToBoolDescConverter}, ConverterParameter=NoLocal}"
                    TextColor="#333"
                    FontSize="13"
                    FontAttributes="Bold"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    HeightRequest="48"
                    Padding="10,0" />
                        </Frame>

                        <!-- RETIRADA -->
                        <Frame
                Grid.Column="1"
                BackgroundColor="{Binding Pedido.LocalConsumo, Converter={StaticResource EnumToBoolDescConverter}, ConverterParameter=Retirada|#FFF0E6|#F9F9F9}"
                CornerRadius="16"
                Padding="0"
                BorderColor="#DDDDDD"
                HasShadow="False"
                HorizontalOptions="Fill">
                            <syncfusionButtons:SfRadioButton
                    Text="Retirada"
                    IsChecked="{Binding Pedido.LocalConsumo, Converter={StaticResource EnumToBoolDescConverter}, ConverterParameter=Retirada}"
                    TextColor="#333"
                    FontSize="13"
                    FontAttributes="Bold"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    HeightRequest="48"
                    Padding="10,0" />
                        </Frame>

                        <!-- ENTREGA -->
                        <Frame
                Grid.Column="2"
                BackgroundColor="{Binding Pedido.LocalConsumo, Converter={StaticResource EnumToBoolDescConverter}, ConverterParameter=Entrega|#FFF0E6|#F9F9F9}"
                CornerRadius="16"
                Padding="0"
                BorderColor="#DDDDDD"
                HasShadow="False"
                HorizontalOptions="Fill">
                            <syncfusionButtons:SfRadioButton
                    Text="Entrega"
                    IsChecked="{Binding Pedido.LocalConsumo, Converter={StaticResource EnumToBoolDescConverter}, ConverterParameter=Entrega}"
                    TextColor="#333"
                    FontSize="13"
                    FontAttributes="Bold"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    HeightRequest="48"
                    Padding="10,0" />
                        </Frame>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- 3. MESA OU CARRO -->
            <Frame IsVisible="{Binding Pedido.MostrarTipoAtendimento}" BackgroundColor="#FFFFFF" CornerRadius="18" Padding="18" BorderColor="#EEEEEE" HasShadow="False">
                <VerticalStackLayout Spacing="12">
                    <Label Text="3. Mesa ou Carro?" FontSize="17" FontAttributes="Bold" TextColor="#FF6B35" />
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="16">
                        <!-- MESA -->
                        <Frame BackgroundColor="{Binding Pedido.IsMesa, Converter={StaticResource BoolToColorConverter}, ConverterParameter=#FFF0E6|#F9F9F9}" CornerRadius="14" Padding="12" BorderColor="#DDDDDD" HasShadow="False" Grid.Column="0">
                            <syncfusionButtons:SfRadioButton Text="Mesa" IsChecked="{Binding Pedido.IsMesa}" />
                        </Frame>
                        <!-- CARRO -->
                        <Frame BackgroundColor="{Binding Pedido.IsMesa, Converter={StaticResource InverseBoolToColorConverter}, ConverterParameter=#FFF0E6|#F9F9F9}" CornerRadius="14" Padding="12" BorderColor="#DDDDDD" HasShadow="False" Grid.Column="1">
                            <syncfusionButtons:SfRadioButton Text="Carro" IsChecked="{Binding Pedido.IsMesa, Converter={StaticResource InverseBooleanConverter}}" />
                        </Frame>
                    </Grid>

                    <!-- MESA -->
                    <VerticalStackLayout IsVisible="{Binding Pedido.IsMesa}" Spacing="8" Margin="0,10,0,0">
                        <Label Text="Selecione a Mesa:" FontSize="14" TextColor="#555" />
                        <Frame BackgroundColor="#F9F9F9" CornerRadius="14" Padding="0" BorderColor="#DDDDDD" HasShadow="False">
                            <syncfusion:SfComboBox
                                ItemsSource="{Binding Mesas}"
                                SelectedItem="{Binding Pedido.Identificador}"
                                TextColor="#333333"
                                FontSize="15"
                                Background="#F9F9F9"
                                Margin="14,10"
                                HeightRequest="48" />
                        </Frame>
                    </VerticalStackLayout>

                    <!-- CARRO -->
                    <VerticalStackLayout IsVisible="{Binding Pedido.IsMesa, Converter={StaticResource InverseBooleanConverter}}" Spacing="8" Margin="0,10,0,0">
                        <Label Text="Placa do Carro:" FontSize="14" TextColor="#555" />
                        <Frame BackgroundColor="#F9F9F9" CornerRadius="14" Padding="0" BorderColor="#DDDDDD" HasShadow="False">
                            <Entry
                                Text="{Binding Pedido.Identificador}"
                                Placeholder="ABC-1234"
                                TextColor="#333333"
                                FontSize="15"
                                MaxLength="8"
                                Margin="14,10"
                                HeightRequest="48" />
                        </Frame>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- BOTÕES -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="14">
                <syncfusionButtons:SfButton
                    Text="Cancelar"
                    Command="{Binding CancelarCommand}"
                    Background="#FF4444"
                    TextColor="White"
                    FontAttributes="Bold"
                    FontSize="16"
                    CornerRadius="14"
                    HeightRequest="54"
                    Padding="20,0"
                    Grid.Column="0" />

                <syncfusionButtons:SfButton
                    Text="Salvar Pedido"
                    Command="{Binding SalvarPedidoCommand}"
                    Background="#FF6B35"
                    TextColor="White"
                    FontAttributes="Bold"
                    FontSize="16"
                    CornerRadius="14"
                    HeightRequest="54"
                    Padding="20,0"
                    Grid.Column="1" />
            </Grid>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>