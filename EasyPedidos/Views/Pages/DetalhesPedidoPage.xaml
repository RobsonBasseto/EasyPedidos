<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:syncfusionButtons="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
             x:Class="EasyPedidos.Pages.DetalhesPedidoPage"
             BackgroundColor="#FFFFFF">

    <ScrollView>
        <VerticalStackLayout Padding="20,35,20,25" Spacing="22">

            <!-- CABEÇALHO -->
            <VerticalStackLayout HorizontalOptions="Center" Spacing="10">
                <Label Text="Detalhes do Pedido"
                       FontSize="26"
                       FontAttributes="Bold"
                       TextColor="#FF6B35"
                       HorizontalOptions="Center" />
            </VerticalStackLayout>

            <!-- 1. INFORMAÇÕES DO PEDIDO -->
            <Frame BackgroundColor="#FFFFFF"
                   CornerRadius="18"
                   Padding="18"
                   BorderColor="#EEEEEE"
                   HasShadow="False">

                <VerticalStackLayout Spacing="14">
                    <Label Text="1. Informações"
                           FontSize="17"
                           FontAttributes="Bold"
                           TextColor="#FF6B35" />

                    <!-- Número do Pedido -->
                    <Grid ColumnDefinitions="*, Auto" ColumnSpacing="10">
                        <Label Text="Número:" FontSize="15" FontAttributes="Bold" TextColor="#333" />
                        <Label Text="{Binding Pedido.Id, StringFormat='#{0}'}"
                               FontSize="15"
                               TextColor="#555"
                               HorizontalOptions="End" />
                    </Grid>

                    <!-- Identificador (Mesa / Carro / Cliente) -->
                    <Grid ColumnDefinitions="*, Auto" ColumnSpacing="10">
                        <Label Text="{Binding Pedido.IdentificadorLabel}"
                               FontSize="15" FontAttributes="Bold" TextColor="#333" />
                        <Label Text="{Binding Pedido.Identificador}"
                               FontSize="15" TextColor="#555"
                               HorizontalOptions="End" />
                    </Grid>

                    <!-- Status -->
                    <Grid ColumnDefinitions="*, Auto" ColumnSpacing="10">
                        <Label Text="Status:" FontSize="15" FontAttributes="Bold" TextColor="#333" />
                        <Label Text="{Binding Pedido.StatusDescricao}"
                               FontSize="15" TextColor="#555"
                               HorizontalOptions="End" />
                    </Grid>

                    <!-- Local de Consumo -->
                    <Grid ColumnDefinitions="*, Auto" ColumnSpacing="10">
                        <Label Text="Local de Consumo:"
                               FontSize="15" FontAttributes="Bold" TextColor="#333" />
                        <Label Text="{Binding Pedido.LocalConsumosDescricao}"
                               FontSize="15"
                               TextColor="#555"
                               HorizontalOptions="End" />
                    </Grid>

                    <!-- Data e Hora -->
                    <Grid ColumnDefinitions="*, Auto" ColumnSpacing="10">
                        <Label Text="Data/Hora:"
                               FontSize="15" FontAttributes="Bold" TextColor="#333" />
                        <Label Text="{Binding Pedido.DataHora, StringFormat='{0:dd/MM/yyyy HH:mm}'}"
                               FontSize="15"
                               TextColor="#555"
                               HorizontalOptions="End" />
                    </Grid>

                </VerticalStackLayout>
            </Frame>

            <!-- 2. ITENS DO PEDIDO -->
            <Frame BackgroundColor="#FFFFFF"
                   CornerRadius="18"
                   Padding="18"
                   BorderColor="#EEEEEE"
                   HasShadow="False">

                <VerticalStackLayout Spacing="14">

                    <Label Text="2. Itens do Pedido"
                           FontSize="17"
                           FontAttributes="Bold"
                           TextColor="#FF6B35" />

                    <CollectionView ItemsSource="{Binding Pedido.Itens}"
                                    EmptyView="Nenhum item no pedido."
                                    HeightRequest="320">

                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#FFFFFF"
                                       CornerRadius="16"
                                       Padding="14"
                                       Margin="0,6"
                                       HasShadow="True">

                                    <Frame.Shadow>
                                        <Shadow Brush="#10000000" Offset="0,2" Radius="6" />
                                    </Frame.Shadow>

                                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">

                                        <!-- Informações do item -->
                                        <VerticalStackLayout Grid.Column="0" Spacing="5">
                                            <Label Text="{Binding Nome}"
                                                   FontSize="15"
                                                   FontAttributes="Bold"
                                                   TextColor="#333" />

                                            <Label Text="{Binding Quantidade, StringFormat='{0}x'}"
                                                   FontSize="13"
                                                   TextColor="#777" />

                                            <Label Text="{Binding Preco, StringFormat='R$ {0:F2}'}"
                                                   FontSize="13"
                                                   TextColor="#777" />

                                            <Label Text="{Binding Subtotal, StringFormat='Subtotal: R$ {0:F2}'}"
                                                   FontSize="13"
                                                   FontAttributes="Bold"
                                                   TextColor="#FF6B35" />
                                        </VerticalStackLayout>

                                        <!-- PREÇO À DIREITA -->
                                        <Label Grid.Column="1"
                                               Text="{Binding Subtotal, StringFormat='R$ {0:F2}'}"
                                               FontSize="17"
                                               FontAttributes="Bold"
                                               TextColor="#FF6B35"
                                               VerticalOptions="Center"
                                               HorizontalOptions="End" />
                                    </Grid>

                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>

                    </CollectionView>

                    <!-- TOTAL -->
                    <BoxView HeightRequest="1" BackgroundColor="#EEEEEE" Margin="0,8" />

                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                        <Label Text="Total:"
                               FontSize="19"
                               FontAttributes="Bold"
                               TextColor="#333" />

                        <Label Text="{Binding Pedido.Total, StringFormat='R$ {0:F2}'}"
                               FontSize="21"
                               FontAttributes="Bold"
                               TextColor="#FF6B35"
                               HorizontalOptions="End" />
                    </Grid>

                </VerticalStackLayout>
            </Frame>

            <!-- BOTÕES DE AÇÃO -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="14" IsVisible="{Binding Pedido.PodeEditar}">

                <!-- CANCELAR -->
                <syncfusionButtons:SfButton
                    Text="Editar Pedido"
                    Command="{Binding EditarPedidoCommand}"
                    Background="#FF4444"
                    TextColor="White"
                    FontAttributes="Bold"
                    FontSize="16"
                    CornerRadius="14"
                    HeightRequest="54"
                    Padding="20,0"
                    Grid.Column="0" />

                <!-- FINALIZAR PEDIDO -->
                <syncfusionButtons:SfButton
                    Text="Concluir"
                    Command="{Binding ConcluirPedidoCommand}"
                    Background="#FF6B35"
                    TextColor="White"
                    FontAttributes="Bold"
                    FontSize="16"
                    CornerRadius="14"
                    HeightRequest="54"
                    Padding="20,0"
                    Grid.Column="1" />

            </Grid>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
