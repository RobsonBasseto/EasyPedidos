<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:helpers="clr-namespace:EasyPedidos.Helpers"
             x:Class="EasyPedidos.Pages.FinalizarPedidoPage"
             Title="Finalizar Pedido">
    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">
            <Label Text="Finalização do Pedido" FontSize="24" FontAttributes="Bold" HorizontalOptions="Center" />

            <!-- Informações -->
            <Frame BackgroundColor="SlateGray" Padding="15">
                <VerticalStackLayout Spacing="10">
                    <Grid ColumnDefinitions="*, *">
                        <Label Text="{Binding Pedido.IdentificadorLabel}" FontSize="16" FontAttributes="Bold" Grid.Column="0"/>
                        <Label Text="{Binding Pedido.Identificador}" FontSize="16" Grid.Column="1"/>
                    </Grid>
                    <Grid ColumnDefinitions="*, *">
                        <Label Text="Número:" FontSize="16" FontAttributes="Bold" Grid.Column="0"/>
                        <Label Text="{Binding Pedido.Id, StringFormat='#{0}'}" FontSize="16" Grid.Column="1"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Itens -->
            <Frame BackgroundColor="SlateGray" Padding="15">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Itens do Pedido:" FontSize="18" FontAttributes="Bold"/>
                    <CollectionView ItemsSource="{Binding Pedido.Itens}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#2F4F4F" Padding="10" Margin="0,2">
                                    <Grid ColumnDefinitions="*, Auto, Auto" ColumnSpacing="10">
                                        <Label Text="{Binding Nome}" FontSize="14" TextColor="White" Grid.Column="0"/>
                                        <Label Text="{Binding Quantidade, StringFormat='{0}x'}" FontSize="12" TextColor="LightGray" Grid.Column="1"/>
                                        <Label Text="{Binding Preco, StringFormat='R$ {0:F2}'}" FontSize="12" TextColor="LightGray" Grid.Column="2"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                    <BoxView HeightRequest="1" BackgroundColor="#CCCCCC" Margin="0,10"/>
                    <Grid ColumnDefinitions="*, Auto">
                        <Label Text="Total:" FontSize="18" FontAttributes="Bold" Grid.Column="0"/>
                        <Label Text="{Binding Pedido.Total, StringFormat='R$ {0:F2}'}" FontSize="18" FontAttributes="Bold" Grid.Column="1"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Pagamento -->
            <Frame BackgroundColor="SlateGray" Padding="15">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Forma de Pagamento:" FontSize="16" FontAttributes="Bold"/>
                    <Picker Title="Selecione..." ItemsSource="{Binding FormasPagamento}" SelectedItem="{Binding FormaPagamentoSelecionada}">
                        <!--<Picker.ItemDisplayBinding>
                            <Binding Converter="{x:Static helpers:EnumToDescriptionConverter.Instance}" />
                        </Picker.ItemDisplayBinding>-->
                    </Picker>
                    <Frame BackgroundColor="#2F4F4F" Padding="10" IsVisible="{Binding MostrarCampoDinheiro}">
                        <VerticalStackLayout Spacing="8">
                            <Label Text="Pagamento em Dinheiro" FontSize="14" FontAttributes="Bold" TextColor="White"/>
                            <Entry Text="{Binding ValorRecebidoString}" Placeholder="Valor recebido..." Keyboard="Numeric" BackgroundColor="White" TextColor="Black"/>
                            <Label Text="{Binding Troco, StringFormat='Troco: R$ {0:F2}'}" FontSize="14" FontAttributes="Bold" TextColor="LightGreen" IsVisible="{Binding TemTroco}"/>
                        </VerticalStackLayout>
                    </Frame>
                </VerticalStackLayout>
            </Frame>

            <!-- Botões -->
            <Button Text="Finalizar" Command="{Binding FinalizarCommand}" BackgroundColor="#4CAF50" TextColor="White" FontAttributes="Bold" HorizontalOptions="Fill"/>
            <Button Text="Cancelar" Command="{Binding CancelarCommand}" BackgroundColor="#757575" TextColor="White" FontAttributes="Bold"/>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>